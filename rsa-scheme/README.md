# RSA Scheme Implementation

## Planning

Good intro readings/videos:
- [Original RSA paper](http://people.csail.mit.edu/rivest/Rsapaper.pdf)
- https://www.youtube.com/watch?v=wXB-V_Keiu8
- [Medium article](https://hackernoon.com/how-does-rsa-work-f44918df914b)
- [UW notes](https://sites.math.washington.edu/~morrow/336_09/papers/Yevgeny.pdf)

Functionality that we need ([Example for reference](https://gist.github.com/JonCooperWorks/5314103)):
- `gcd(x, y)`: Implement a function to find the GCD for use in determining if two numbers x, y are coprime `gcd(x, y) == 1`
- `generate_large_prime`
    - `generate_seed`: Be able to generate a random seed from 0 to some large number. This seed will determine the primes generated. We can also implement a way for the user to regenerate a seed.
- `is_prime(x)`: (Efficiently) checks whether or not a given number is prime.
    - Implement Miller-Rabin algorithm for efficiency. Read into why it's more efficient.
    - Create a list of "small primes" to check through before running Miller-Rabin to save time in a lot of cases.
    - Reading: [Implementation Example](https://langui.sh/2009/03/07/generating-very-large-primes/), [another article](https://medium.com/@prudywsh/how-to-generate-big-prime-numbers-miller-rabin-49e6e6af32fb)
- `encrypt(keypair, unencrypted)`: Encrypt a message with a public/private key pair.
- `decrypt(keypair, encrypted)`: Decrypt an encrypted message with a corresponding key pair.

Read into Dev's suggestions:
- OAEP padding to prevent attacks based on homomorphic properties
    - [Article on OAEP and example impelementation](https://medium.com/blue-space/improving-the-security-of-rsa-with-oaep-e854a5084918)
- Chinese Remainder Theorem
    - https://crypto.stanford.edu/pbc/notes/numbertheory/crt.html
    - https://www.di-mgt.com.au/crt_rsa.html
    - https://crypto.stackexchange.com/questions/2575/chinese-remainder-theorem-and-rsa
- Protections for different random specialized factoring (attacks trying to find p and q through factoring N = pq)
- Constant time Montgomery form exponentiation
    - https://en.wikipedia.org/wiki/Montgomery_modular_multiplication

Attacks:
- [Factorization "attack" 512 bit RSA = $75](https://arstechnica.com/information-technology/2015/10/breaking-512-bit-rsa-with-amazon-ec2-is-a-cinch-so-why-all-the-weak-keys/)
- [Possible RSA attacks](http://www.members.tripod.com/irish_ronan/rsa/attacks.html)
- [Why factorization takes so long/why is RSA actually secure](http://www.members.tripod.com/irish_ronan/rsa/factorization.html)
- THIS IS WHY YOU NEED PADDING:
    - `When encrypting with low encryption exponents (e.g., e = 3) and small values of the m, (i.e., m < n1/e) the result of me is strictly less than the modulus n. In this case, ciphertexts can be easily decrypted by taking the eth root of the ciphertext over the integers.`
    - https://en.wikipedia.org/wiki/RSA_(cryptosystem)#Attacks_against_plain_RSA

## Usage

Clone this repository and run `$ python3 rsa.py`

Example output:
```
What is your name? Oski
Generating your RSA keys...

What is your message (as a string or an integer)? Blockchain at Berkeley 🙌

Your encrypted message is:

Encrypted Character #0:
30947368915576646437271578797965044305357719808856552835742505340706959644880189570974097248575444702785655223865866573913257529422008674808503567258733850956199357631988312255015743156592194347147077733711925822655093839873096546287170518574819335410824148879733859573201419972876281799685630278200392882184
Encrypted Character #1:
12364439301372692936746698885579693498722901081576680899575858247476651908986597328336025358652478839442619597193706748184669913660737102214314634808528990610531361029159031209307010352128614957178067726710598196391818907931206068517659722769981820945188352199728458174554493018377977376376940596421543182264
Encrypted Character #2:
24925365184345671737841129450156424554993246059255685880861701628206791804854682167895765478933550511429412012926640268019620708796250767703999157808438749731260528898932774728746520159727863511909507916597234605721279974650776479549358023122939950936750391140772122434098856368257881649581387429874478620489
Encrypted Character #3:
54366825789749538801386478212301493582887732020586066292494889354833866040401493024225806727844092005047767655145480848023033789087943794784524343137615217724520677201886857130857785384749770924917149002321321180063106948836743856528032366237233290374749911676500356981261152235230662216068204167366163940712
Encrypted Character #4:
15781683712247466338942929728674447896039359981166341044281612342209074273577604259694340279873364826745601225249767036632067063281448017641722721073245688295283815350492158028545590189290293945167254599647080660615302144886424881110146890390460266098197035835246278255696200257241890196372466522740992939919
Encrypted Character #5:
54366825789749538801386478212301493582887732020586066292494889354833866040401493024225806727844092005047767655145480848023033789087943794784524343137615217724520677201886857130857785384749770924917149002321321180063106948836743856528032366237233290374749911676500356981261152235230662216068204167366163940712
Encrypted Character #6:
33881199237803681925245956606180682304045105333734420022559827840703776632162752635145686221716169439122604304517959058139694997872301978320010554419766519451218088619176307465934891298345374525912197827197580660047201020259771923581089582800467858986457368799846126871979111904767430816750640202630785329741
Encrypted Character #7:
40611493639170452985736666032581184326398793610659871941399341506593783046307753452682231602249771326272013242600215550128430813174553552886447489294838802868773580106264018677808813783570158106165748452380609060997050940513262067647174748630310287283976057085753019863989565085817631303603531300630300720803
Encrypted Character #8:
60115057860559601694392259006683984397310826474783184500947032064032425533180827974761312548621232140933677915182886291145139259758097637802972511628561140990750871680645833356473644559910442242612186950555649709645088248794234723411314889731781065470100951760811979188862723593540071295261358844564445888458
Encrypted Character #9:
51634597315847262620398397187831117905315345463279931029352465580837886113989060904137787184949247032264217672025500042210679825908867504653656068967961315567551562615253913781936701115425968620374812205148273740606716047699433191462514135463054231044821729043217002212083437195532384305487827105364589249003
Encrypted Character #10:
63541914070208365477264460572981632197311383410999594243844310729742517220838188215448974732370998008263133910997188458636123825857048051869047212227018968553209292962297980335131226191145704949766333445131856906250668805997872524052164196752741964710224942707541812921727266059300419519565480202998126279690
Encrypted Character #11:
40611493639170452985736666032581184326398793610659871941399341506593783046307753452682231602249771326272013242600215550128430813174553552886447489294838802868773580106264018677808813783570158106165748452380609060997050940513262067647174748630310287283976057085753019863989565085817631303603531300630300720803
Encrypted Character #12:
20289682624318579308354535241898083655301084377189654156581543409728801290174945968832493647341707327468121306795346816274836109132589365449655782929857995241897335211660671206243723747891440092974352666074569497428938561832205971854358118935664027130690353832966009847118803894473754068178562368553328132516
Encrypted Character #13:
63541914070208365477264460572981632197311383410999594243844310729742517220838188215448974732370998008263133910997188458636123825857048051869047212227018968553209292962297980335131226191145704949766333445131856906250668805997872524052164196752741964710224942707541812921727266059300419519565480202998126279690
Encrypted Character #14:
30947368915576646437271578797965044305357719808856552835742505340706959644880189570974097248575444702785655223865866573913257529422008674808503567258733850956199357631988312255015743156592194347147077733711925822655093839873096546287170518574819335410824148879733859573201419972876281799685630278200392882184
Encrypted Character #15:
27592980928966988572110957077750576612978847117057189676052636411539693670471373531098875930231647647536544161745687942652484278726198772259582118773081213273961863090614375049779644333902242352602304018618901130443029722051865615881834518191510527035151975087526432038482006963440879914990860184117992974853
Encrypted Character #16:
4416299148162224419945459406172558388842008521058126829788175715759967144096006255721321695694462689696180999496188074449359100042543441605582230227819333278173358618833083353806644459665542030533963015095260647583068932923436089726836904409769760600397419523612038776132349093832013055010700844388225653185
Encrypted Character #17:
15781683712247466338942929728674447896039359981166341044281612342209074273577604259694340279873364826745601225249767036632067063281448017641722721073245688295283815350492158028545590189290293945167254599647080660615302144886424881110146890390460266098197035835246278255696200257241890196372466522740992939919
Encrypted Character #18:
27592980928966988572110957077750576612978847117057189676052636411539693670471373531098875930231647647536544161745687942652484278726198772259582118773081213273961863090614375049779644333902242352602304018618901130443029722051865615881834518191510527035151975087526432038482006963440879914990860184117992974853
Encrypted Character #19:
12364439301372692936746698885579693498722901081576680899575858247476651908986597328336025358652478839442619597193706748184669913660737102214314634808528990610531361029159031209307010352128614957178067726710598196391818907931206068517659722769981820945188352199728458174554493018377977376376940596421543182264
Encrypted Character #20:
27592980928966988572110957077750576612978847117057189676052636411539693670471373531098875930231647647536544161745687942652484278726198772259582118773081213273961863090614375049779644333902242352602304018618901130443029722051865615881834518191510527035151975087526432038482006963440879914990860184117992974853
Encrypted Character #21:
65065261928239144318569620161858348352970436277868243629826537795108962787425509937975069037349321849551491382893425524944188481881056774393209349442559603489105767012296127304175885311045349535110322778538755423185799320299579162936169248678257319297951806044606435022547579183783292466927575453819369557678
Encrypted Character #22:
63541914070208365477264460572981632197311383410999594243844310729742517220838188215448974732370998008263133910997188458636123825857048051869047212227018968553209292962297980335131226191145704949766333445131856906250668805997872524052164196752741964710224942707541812921727266059300419519565480202998126279690
Encrypted Character #23:
62967520899879467309462070154098874137205188817372398122474184964972130724251434466458276497029675326382397119462939461341547322813530174450824533096763988178806792839940553213462412997769970325216103056329300437541029754575712670855047092052979892905734457468800310209604174873061190130065599610495421591647

John DeNero, a user with different public/private key pairs, cannot decrypt your message!
He does not have the correct private key pair. This is what they get trying to decrypt your message:

Error! The other user cannot convert their decrypted message back to a string.

Only you are able to decrypt the message.
Your decrypted (original) message is: Blockchain at Berkeley 🙌
```

## High Level Summary

**Goal:** You want to receive ecrypted messages that only you can read.

To do this, you publish a public "lock" that anyone can use to encrypt their message.
Only you have the private "key" needed to decrypt this "locked" message to access the sender's original message.
The encrypted message is meaningless to anyone else trying to read it.

Think of this "lock" as a function `E` that takes in an integer and outputs the encrypted version. Think of the "key" as a function `D` that takes in an encryption and returns the original message. These two functions are inverses, so the following holds:
`D(E(x)) == x`.

However, since we don't want everyone to have access to the message, we need to find a special function `E`, such that it is practically infeasible to find the inverse without knowing some information beforehand.
In other words, unless you are the owner of the "lock" and "key", you shouldn't be able to come up with the function `D` that reveals the original message.
To accomplish this, we can use modular arithmetic.

## Modular Arithmetic

...

## Implementing RSA

A basic RSA implementation includes the following:
1. Generation of a public and private key pairs.
2. Encryption of a given message using the public key.
3. Decryption to reveal an encrypted message using the private key.

### 1. Generating Public and Private Keys 🔑🗝

First, generate two large prime numbers `p` and `q`. Define a modulus `N` to be the product `p * q`.
Define the totient of N to be `(p - 1) * (q - 1)`.

Choose an integer `e` that is coprime (shares no common factors other than 1) with `(p - 1) * (q - 1)`.
Find `d`, the multiplicative inverse of `e mod (p - 1) * (q - 1)`.

Your generated public and private key pairs are `(N, e)` and `(N, d)`, respectively.

### 2. Encrypting a Message

### 3. Decrypting
